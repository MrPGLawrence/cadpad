function BuildModelViewers(e){jQuery(e).each(function(){BuildModelViewer(jQuery(this).attr("href"),this)})}function BuildModelViewer(e,n){windowWidth=window.innerWidth/windowRatio,windowHeight=window.innerHeight/windowRatio;var i=e.substring(e.length-3).toLowerCase().trim();if("obj"===i||"stl"===i){var t,r,o,a,d,s,u,l,w;switch(t=document.createElement("div"),document.body.appendChild(t),r=new THREE.PerspectiveCamera(45,windowWidth/windowHeight,1,1e3),r.position.z=1,a=new THREE.Scene,s=new THREE.AmbientLight(16777215,.8),u=new THREE.DirectionalLight(new THREE.Color("hsl(30, 100%, 75%)"),.8),u.position.set(-100,0,100),l=new THREE.DirectionalLight(new THREE.Color("hsl(240, 100%, 75%)"),.5),l.position.set(100,0,100),w=new THREE.DirectionalLight(16777215,.8),w.position.set(100,0,-100).normalize(),a.add(s),a.add(u),a.add(l),a.add(w),i){case"obj":var c=new THREE.OBJLoader;c.load(e,function(e){var n=e.children[0].geometry,i=new THREE.MeshLambertMaterial;i.color=new THREE.Color("#33cc33"),i.emissiveIntensity=3;var t=new THREE.Mesh(n,i),o=(new THREE.Box3).setFromObject(t);o.getCenter(t.position),t.position.multiplyScalar(-1);var d=new THREE.Group;a.add(d),d.add(t),t.geometry.computeBoundingBox();var s=2*Math.atan(t.geometry.boundingBox.getSize().y/(2*r.position.z))*(180/Math.PI);r.position.z=s,r.updateProjectionMatrix()});break;case"stl":var c=new THREE.STLLoader;c.load(e,function(e){var n=new THREE.MeshLambertMaterial;n.color=new THREE.Color("#33cc33"),n.emissiveIntensity=3;var i=new THREE.Mesh(e,n),t=(new THREE.Box3).setFromObject(i);t.getCenter(i.position),i.position.multiplyScalar(-1);var o=new THREE.Group;a.add(o),o.add(i),i.geometry.computeBoundingBox();var d=2*Math.atan(i.geometry.boundingBox.getSize().y/(2*r.position.z))*(180/Math.PI);r.position.z=d,r.updateProjectionMatrix()})}d=new THREE.WebGLRenderer,d.setPixelRatio(window.devicePixelRatio),d.setSize(windowWidth,windowHeight),d.setClearColor(new THREE.Color("hsl(0, 0%, 10%)")),t.appendChild(d.domElement),o=new THREE.OrbitControls(r,d.domElement),o.enableDamping=!0,o.dampingFactor=.25,o.enableZoom=!0,o.enablePan=!1,cameraGroup.push(r),containerGroup.push(t),sceneGroup.push(a),rendererGroup.push(d),controlsGroup.push(o);var h=containerGroup.length-1+"-model-viewer";if(jQuery(t).attr("id",h),jQuery(t).addClass("mfp-hide"),jQuery(t).addClass("white-popup"),jQuery(n).magnificPopup({items:{src:"#"+h,type:"inline"}}),0==jQuery(".attach-file").length&&!jQuery(n).hasClass("preview-model")){var p=object_name.templateUrl;jQuery('<a class="dlm-btn fre-btn" href="'+e+'">Download</a>').insertAfter(jQuery(n));var m=jQuery('<button class="prn-btn fre-btn" type="submit" value="Print">Print</button>').insertAfter(jQuery(n));m.click(function(n){var i=jQuery(".prn-btn");n.preventDefault(),jQuery(i).each(function(){jQuery(this).attr("disabled","disabled"),jQuery(this).addClass("disabled")}),jQuery.ajax({type:"POST",url:p+"/3dhubs/print.php",data:{file:e},success:function(e){window.location.href=e},complete:function(){jQuery(i).each(function(){jQuery(this).removeAttr("disabled"),jQuery(this).removeClass("disabled")})}})})}jQuery(n).attr("href","")}}function onWindowResize(){windowWidth=window.innerWidth/windowRatio,windowHeight=window.innerHeight/windowRatio;for(var e=0;e<cameraGroup.length;e++)cameraGroup[e].aspect=windowWidth/windowHeight,cameraGroup[e].updateProjectionMatrix(),rendererGroup[e].setSize(windowWidth,windowHeight)}function animate(){requestAnimationFrame(animate);for(var e=0;e<controlsGroup.length;e++)controlsGroup[e].update();render()}function render(){for(var e=0;e<rendererGroup.length;e++)rendererGroup[e].render(sceneGroup[e],cameraGroup[e])}Detector.webgl||Detector.addGetWebGLMessage();var containerGroup=new Array,cameraGroup=new Array,controlsGroup=new Array,sceneGroup=new Array,rendererGroup=new Array,modelLinks=new Array,windowRatio=1.5,windowWidth=window.innerWidth/windowRatio,windowHeight=window.innerHeight1/windowRatio;jQuery(document).ready(function(){modelLinks=jQuery(".list-file-attack .file-attack-name a"),BuildModelViewers(modelLinks),animate()}),jQuery(document).ajaxSuccess(function(){var e=jQuery(".list-file-attack .file-attack-name a");modelLinks.length!=e&&(e.each(function(){for(var e=jQuery(this).attr("href"),n=jQuery(this).text(),i=this,t=0;t<modelLinks.length;t++){var r=jQuery(modelLinks[t]).text();if(n==r)break;t==modelLinks.length-1&&BuildModelViewer(e,i)}}),modelLinks=e)}),window.addEventListener("resize",onWindowResize,!1);